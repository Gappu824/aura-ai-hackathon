version: 1
frontend:
  phases:
    preBuild:
      commands:
        - cd frontend/aura-ai-ui/ # Go into your frontend app directory
        - npm install              # Install dependencies
    build:
      commands:
        - npm run build                      # Build your Next.js app
        # --- START CRITICAL MODIFICATION ---
        # Create a dedicated output directory *relative to the current working directory*
        # This is where npm run build also operates. It will be 'frontend/aura-ai-ui/out_for_amplify'
        - mkdir -p ./out_for_amplify
        # Copy the built Next.js output from .next (relative to current working dir)
        # into this new 'out_for_amplify' dir
        - cp -R .next/* ./out_for_amplify/
        # --- END CRITICAL MODIFICATION ---
  # appRoot defines the base for commands in phases. This is correct.
  appRoot: frontend/aura-ai-ui
  artifacts:
    # --- START CRITICAL MODIFICATION ---
    # Specify the baseDirectory for artifacts relative to the *appRoot*
    # So, Amplify will look inside 'frontend/aura-ai-ui/' for 'out_for_amplify/'
    baseDirectory: out_for_amplify
    # --- END CRITICAL MODIFICATION ---
    files:
      - '**/*'
  cache:
    # This caching path is typically relative to the repository root.
    # It should still be fine, or could be 'frontend/aura-ai-ui/node_modules/**/*' if needed.
    paths:
      - node_modules/**/*