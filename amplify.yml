version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Change directory to your frontend app's root within the cloned repo
        # Amplify will clone the repo to /codebuild/output/src/<repo-name>/
        - cd frontend/aura-ai-ui/
        - npm install
    build:
      commands:
        - npm run build
        # Note: The .next folder is generated inside frontend/aura-ai-ui/
        # After 'npm run build', the current working directory is still frontend/aura-ai-ui/
        # For deployment, Amplify needs to pick artifacts from this path.
        # No explicit copy needed if baseDirectory is set correctly relative to the top-level repo.
  # --- START CRITICAL MODIFICATION ---
  # Set appRoot to the *actual* folder that contains your package.json, node_modules, .next folder.
  # This is relative to the *repository root*.
  appRoot: frontend/aura-ai-ui
  artifacts:
    # baseDirectory needs to be relative to the *top-level repository root*.
    # So, it's the path from the Git repo root to the directory containing the build output.
    baseDirectory: frontend/aura-ai-ui/.next
    files:
      - '**/*'
  # --- END CRITICAL MODIFICATION ---
  cache:
    # Cache paths must also be relative to the repository root.
    paths:
      - frontend/aura-ai-ui/node_modules/**/*