version: 1
frontend:
  phases:
    preBuild:
      commands:
        - cd frontend/aura-ai-ui/ # Go into your Next.js app directory
        - npm ci                   # Install dependencies
    build:
      commands:
        - npm run build            # Build your Next.js app
        # --- START CRITICAL MODIFICATION ---
        # Amplify expects artifacts in /<app-root-name>/.next/ for Next.js build output.
        # But sometimes it's finicky. Let's make sure the .next folder is exactly where Amplify needs it.
        # Next.js builds to .next/ *relative to the current working directory (appRoot)*.
        # So, the final built output is at $CODEBUILD_SRC_DIR/frontend/aura-ai-ui/.next
        # We'll copy its *contents* to a new directory that Amplify can easily pick up,
        # which is typically the base of the served content.

        # The error 'Artifact directory doesn't exist: .next' means it looked for
        # $CODEBUILD_SRC_DIR/.next and didn't find it.

        # Let's create a *temp* build output directory at the repository root
        # and copy the *contents* of your frontend's .next/ into it.
        - mkdir -p $CODEBUILD_SRC_DIR/next_dist
        - cp -R ./.next/* $CODEBUILD_SRC_DIR/next_dist/
        # --- END CRITICAL MODIFICATION ---
  appRoot: frontend/aura-ai-ui # This is the app root for the build commands
  artifacts:
    # --- START CRITICAL MODIFICATION ---
    # This baseDirectory is now relative to the *repository root* as Amplify
    # processes it for artifact collection.
    # It needs to point to the directory created *at the root of the repository clone*.
    baseDirectory: next_dist # Point to the folder we just created at repo root
    # --- END CRITICAL MODIFICATION ---
    files:
      - '**/*' # Include all files from this baseDirectory
  cache:
    paths:
      - node_modules/**/* # This path is relative to the *repository root*